--liquibase formatted sql
--changeset ${vr_owner_user}_CODE:TRIGGER_TRG_BOOK_HIERARCHY_RPL_DELETE runOnChange:TRUE  failOnError:TRUE splitStatements:FALSE

CREATE OR REPLACE trigger TRG_BOOK_HIERARCHY_RPL_DELETE 
    BEFORE DELETE ON BOOK_HIERARCHY_RPL 
    FOR EACH ROW
DECLARE
   v_username varchar2(20);  
   
BEGIN


insert into book_hierarchy_rpl_aud values(
:old.ASOFDATE, 
:old.BOOK_ID, 
:old.VOLCKER_TRADING_DESK, 
:old.VOLCKER_TRADING_DESK_FULL, 
:old.LOWEST_LEVEL_RPL_CODE, 
:old.LOWEST_LEVEL_RPL_FULL_NAME, 
:old.LOWEST_LEVEL_RPL, 
:old.SOURCE_SYSTEM, 
:old.LEGAL_ENTITY, 
:old.GLOBAL_TRADER_BOOK_ID, 
:old.PROFIT_CENTER_ID, 
:old.COMMENTS, 
:old.DATA_SOURCE, 
:old.CREATE_DATE, 
:old.LAST_MODIFIED_DATE,
:old.CHARGE_REPORTING_UNIT_CODE, 
:old.CHARGE_REPORTING_UNIT, 
:old.CHARGE_REPORTING_PARENT_CODE, 
:old.CHARGE_REPORTING_PARENT, 
:old.MI_LOCATION, 
:old.UBR_LEVEL_1_ID, 
:old.UBR_LEVEL_1_NAME, 
:old.UBR_LEVEL_1_RPL_CODE, 
:old.UBR_LEVEL_2_ID, 
:old.UBR_LEVEL_2_NAME, 
:old.UBR_LEVEL_2_RPL_CODE, 
:old.UBR_LEVEL_3_ID, 
:old.UBR_LEVEL_3_NAME, 
:old.UBR_LEVEL_3_RPL_CODE, 
:old.UBR_LEVEL_4_ID, 
:old.UBR_LEVEL_4_NAME, 
:old.UBR_LEVEL_4_RPL_CODE, 
:old.UBR_LEVEL_5_ID, 
:old.UBR_LEVEL_5_NAME, 
:old.UBR_LEVEL_5_RPL_CODE, 
:old.UBR_LEVEL_6_ID, 
:old.UBR_LEVEL_6_NAME, 
:old.UBR_LEVEL_6_RPL_CODE, 
:old.UBR_LEVEL_7_ID, 
:old.UBR_LEVEL_7_NAME, 
:old.UBR_LEVEL_7_RPL_CODE, 
:old.UBR_LEVEL_8_ID, 
:old.UBR_LEVEL_8_NAME, 
:old.UBR_LEVEL_8_RPL_CODE, 
:old.UBR_LEVEL_9_ID, 
:old.UBR_LEVEL_9_NAME, 
:old.UBR_LEVEL_9_RPL_CODE, 
:old.UBR_LEVEL_10_ID, 
:old.UBR_LEVEL_10_NAME, 
:old.UBR_LEVEL_10_RPL_CODE, 
:old.UBR_LEVEL_11_ID, 
:old.UBR_LEVEL_11_NAME, 
:old.UBR_LEVEL_11_RPL_CODE, 
:old.UBR_LEVEL_12_ID, 
:old.UBR_LEVEL_12_NAME, 
:old.UBR_LEVEL_12_RPL_CODE, 
:old.UBR_LEVEL_13_ID, 
:old.UBR_LEVEL_13_NAME, 
:old.UBR_LEVEL_13_RPL_CODE, 
:old.UBR_LEVEL_14_ID, 
:old.UBR_LEVEL_14_NAME, 
:old.UBR_LEVEL_14_RPL_CODE, 
:old.DESK_LEVEL_1_ID, 
:old.DESK_LEVEL_1_NAME, 
:old.DESK_LEVEL_1_RPL_CODE, 
:old.DESK_LEVEL_2_ID, 
:old.DESK_LEVEL_2_NAME, 
:old.DESK_LEVEL_2_RPL_CODE, 
:old.DESK_LEVEL_3_ID, 
:old.DESK_LEVEL_3_NAME, 
:old.DESK_LEVEL_3_RPL_CODE, 
:old.DESK_LEVEL_4_ID, 
:old.DESK_LEVEL_4_NAME, 
:old.DESK_LEVEL_4_RPL_CODE, 
:old.DESK_LEVEL_5_ID, 
:old.DESK_LEVEL_5_NAME, 
:old.DESK_LEVEL_5_RPL_CODE, 
:old.PORTFOLIO_ID, 
:old.PORTFOLIO_NAME, 
:old.PORTFOLIO_RPL_CODE,
:old.BUSINESS, 
:old.SUB_BUSINESS,
:old.CREATE_USER, 
:old.LAST_MODIFICATION_USER,
'DELETE',
:old.REGION, 
:old.SUBREGION,
:old.APPROVER_USER,
:old.APPROVAL_DATE,
systimestamp,
:old.COVERED_FUND_BUS_UNIT_RPL_CODE,
:old.COVERED_FUND_BUS_UNIT_NAME,
:old.ACC_TREAT_CATEGORY,
:old.PRIMARY_TRADER,
:old.PRIMARY_BOOK_RUNNER,
:old.PRIMARY_FINCON,
:old.PRIMARY_MOESCALATION,
:old.LEGAL_ENTITY_CODE,
:old.BOOK_FUNCTION_CODE,
:old.REGULATORY_REPORTING_TREATMENT,
:old.UBR_MA_CODE,
:old.HIERARCHY_UBR_NODENAME,
:old.PROFIT_CENTRE_NAME,
--start GBSVR-28871
:old.NON_VTD_CODE,
:old.NON_VTD_NAME,
:old.NON_VTD_RPL_CODE,
:old.NON_VTD_EXCLUSION_TYPE,
--end GBSVR-28871
--start GBSVR-30040
:old.VOLCKER_REPORTABLE_FLAG,
--end GBSVR-30040
--start GBSVR-30224
:old.NON_VTD_DIVISION,  
:old.NON_VTD_PVF, 
:old.NON_VTD_BUSINESS 
--end GBSVR-30224
);

EXCEPTION
     WHEN others THEN
		pkg_monitoring.pr_insert_log_jobs_qv('bRDS',null,:new.SOURCE_SYSTEM,current_date,'TRG_BOOK_HIERARCHY_RPL_DELETE','ERROR', 'FATAL', 'Error:'||TO_CHAR(SQLCODE), SUBSTR(SQLERRM, 1, 2500), 'bRDS');
END;
